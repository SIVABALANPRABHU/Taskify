{% extends 'base.html' %}
{% block title %}{{ name }}'s Profile{% endblock %}
{% block content %}
    <h1>{{ name }}'s Calendar</h1>
    <h3>{{ start_date|date:"Y-m-d" }} to {{ end_date|date:"Y-m-d" }}</h3>

    <!-- Start/End Date Filter Form -->
    <form method="GET" action="{% url 'assignee_profile' name=name %}">
        <label for="start_date">Start Date (YYYY-MM-DD):</label>
        <input type="text" id="start_date" name="start_date" value="{{ start_date|date:'Y-m-d' }}" placeholder="2025-05-01">
        <label for="end_date">End Date (YYYY-MM-DD):</label>
        <input type="text" id="end_date" name="end_date" value="{{ end_date|date:'Y-m-d' }}" placeholder="2025-05-31">
        <button type="submit">Filter</button>
    </form>

    <!-- Navigation for previous/next date range -->
    <div>
        <a href="{% url 'assignee_profile' name=name %}?start_date={{ prev_start_date|date:'Y-m-d' }}&end_date={{ prev_end_date|date:'Y-m-d' }}">Previous Period</a> |
        <a href="{% url 'assignee_profile' name=name %}?start_date={{ next_start_date|date:'Y-m-d' }}&end_date={{ next_end_date|date:'Y-m-d' }}">Next Period</a>
    </div>

    <table style="border-collapse: collapse;">
        <tr>
            <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
        </tr>
        {% for week in calendar %}
            <tr>
                {% for day in week %}
                    {% if day %}
                        {% with date_str=day|date:"Y-m-d" %}
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center; vertical-align: top; {% if date_str in tasks_by_date %}background-color: #e0f7fa;{% endif %}">
                                {% if date_str in tasks_by_date %}
                                    <a href="{% url 'tasks_by_date' name=name date=date_str %}">{{ day.day }}</a>
                                    <br>
                                    <small>({{ tasks_by_date.date_str|length }} task{{ tasks_by_date.date_str|length|pluralize }})</small>
                                    <ul style="list-style: none; padding: 0; font-size: 0.8em;">
                                        {% for task in tasks_by_date.date_str %}
                                            <li>{{ task.task_name }} (ID: {{ task.id }}, {{ task.status }}, {{ task.priority }})</li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    {{ day.day }}
                                {% endif %}
                            </td>
                        {% endwith %}
                    {% else %}
                        <td style="border: 1px solid #ddd; padding: 10px; text-align: center;"></td>
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
    </table>
{% endblock %}